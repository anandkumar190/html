RewriteEngine On

# -------------------------------------------------
# 0) Fix accidental filesystem-path URLs
# Example: /var/www/html/login -> /login
# -------------------------------------------------
RewriteRule ^var/www/html/?(.*)$ /$1 [R=302,L]

# -------------------------------------------------
# 1) API: do NOT rewrite/redirect
# -------------------------------------------------
RewriteRule ^api/ - [L]

# -------------------------------------------------
# 2) Canonical: redirect *.php -> no extension (GET only)
# Example: /login.php -> /login
# IMPORTANT: do NOT redirect POST requests (fixes login POST 301 issue)
# -------------------------------------------------
RewriteCond %{REQUEST_METHOD} !POST
RewriteCond %{THE_REQUEST} \s/+(.+?)\.php[\s?] [NC]
RewriteRule ^ %1 [R=301,L]

# -------------------------------------------------
# 3) Route pretty URL to matching .php if it exists
# Examples: /login -> login.php, /home -> home.php
# -------------------------------------------------
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{DOCUMENT_ROOT}/$1.php -f
RewriteRule ^(.+?)/?$ $1.php [L]

# -------------------------------------------------
# 4) Front controller fallback (optional)
# If not file/dir, send to index.php
# -------------------------------------------------
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^ index.php [L]
